# Self Signed Certificate
- 공인된 기관인 CA(Certificate Authority)를 이용하지 않는 방식이다. 인증서는 서버에서 생성하고, 서버에서 생성한 Private Key로 인증서를 암호화한다. 
- 공인되지 않은 서버에서 인증서와 private key를 소유하고 있기 때문에, 보안에 취약하다는 단점이 있다. 하지만 내부망 또는 소규모 클라이언트 구조에서는 비용을 아낄 수 있다는 장점이 있다.

## CA를 이용한 인증 방식
- CA를 통해 인증서를 발급받는다. CA는 CA만의 private key를 통해서 해당 인증서를 암호화하여 인증서 구매자에게 인증서를 발급한다.
- 클라이언트 측의 웹브라우저에 해당 CA에 해당하는 Public Key가 내장되어 있다. 이 인증서를 성공적으로 복호화됐다는 사실은, 인증서를 보낸 서버가 공인된 CA로부터 인증을 받았다는 사실이 검증 된 것이다.

### hand shaking

#### 1. Client Hello
1. 클라이언트가 서버로부터 접속을 요청한다. 랜덤데이터, 암호화 방식 후보, 세션아이디를 서버로 보낸다.

#### 2. Server Hello
2. CA에서 발급받고 암호화된 인증서를 클라이언트에게 전송한다. 이와 함께 서버 측 랜덤데이터, 최종 암호화 방식을 함께 보낸다.

#### 3. 인증서 검증
3. 클라이언트는 암호화된 인증서가 어떤 CA인지 확인하고 웹 브라우저에 내장된 해당 CA에 맞는 Public key로 이 인증서를 복호화한다. 복호화가 성공했다는 사실은 서버가 인증되었다는 사실과 같다.
4. 클라이언트는 서버측 클라이언측 두 랜덤데이터를 조합하여 pre master key를 생성하고, 인증서에 있는 Public key로 pre master key를 암호화한 뒤, 서버 측에게 보낸다.

#### 4. 대칭키 생성
5. 서버 측은 pre master key를 private key로 복호화한다. 서버와 클라이언트는 일련의 과정을 통해서 pre master key로 master key를 생성한다. master key는 세션키를 생성한다. 이 세션키를 대칭키로 사용한다.
6. 서버와 클라이언트는 이 세션키(대칭키)를 사용하여 주고 받는 데이터들을 암호화한다.

#### 5. Hand Shake 종료
7. 서버와 클라이언트는 Handshake를 종료를 서로에게 알린다.




## JKS를 이용한 Selft Signed Certificate 방식
- JKS(Java Keystore)를 사용하여 인증서를 암호화하여 보관할 수 있다.

### JKS 준비
1. openssl 툴을 사용하여 인증서(.crt)를 생성한다. 생성할 때, private key도 같이 생성된다. 기본적으로 인정서는 public key를 내장하고 있다.
2. JKS를 생성할 때는 여라가지 방법이 있다. 그 중에 P12 Container 사용하는 방식이 있다. Openssl 툴을 사용하여 인증서와 private key를 p12 container 포맷으로 변환한다.
3. keytool을 사용하여 p12 파일을 JKS 암호화한다. jks로 변환할 때 비밀번호를 입력한다. 이 비밀번호를 통해 암호화된 jks를 복호화할 수 있다.

### Hand Shaking
#### 1. Client Hello
1. 클라이언트가 서버로부터 접속을 요청한다. 랜덤데이터, 암호화 방식 후보, 세션아이디를 서버로 보낸다.

#### 2. Server Hello
2. JKS로 암호된 인증서를 저장된 비밀번호로 복호화하여 인증서를 클라이언트에게 전송한다. 이와 함께 서버 측 랜덤데이터, 최종 암호화 방식을 함께 보낸다.

#### 3. 인증서 검증
3. 클라이언트는 인증서롤 받는다. 인증서에있는 PUBLIC KEY를 확인한다.
4. 클라이언트는 서버측 클라이언측 두 랜덤데이터를 조합하여 pre master key를 생성하고, 인증서에 있는 Public key로 pre master key를 암호화한 뒤, 서버 측에게 보낸다.

#### 4. 대칭키 생성
5. 서버 측은 pre master key를 private key로 복호화한다. 서버와 클라이언트는 일련의 과정을 통해서 pre master key로 master key를 생성한다. master key는 세션키를 생성한다. 이 세션키를 대칭키로 사용한다.
6. 서버와 클라이언트는 이 세션키(대칭키)를 사용하여 주고 받는 데이터들을 암호화한다.

#### 5. Hand Shake 종료
7. 서버와 클라이언트는 Handshake를 종료를 서로에게 알린다.