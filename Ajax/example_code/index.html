<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <title>Ajax Test</title>
</head>
<style>
  textarea {
    margin: 10px 0;
  }
  table {
      border-collapse: collapse;
      width: 100%;
  }

  th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
  }
</style>
<body>
  <div class="formm">
    <input type="text" id="comment_name"><br>
    <textarea rows="2" cols="50" id="comment_txt"></textarea> <br>
    <input type="submit" value="보내기" id="comment_submit">
  </div>

  <table>
    <tbody class="result">
      <tr class="th">
        <th>이름</th>
        <th>내용</th>
      </tr>
    </tbody>
  </table>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script>

    $("#comment_submit").on("click",function(event){
      // 댓글 데이터 객체 생성
      var jsonAjax = {};
      var commentObj = {};
      commentObj[$("#comment_name").val()] = $("#comment_txt").val();

      // JSON 형태로 변경
      var jsonAjax = JSON.stringify(commentObj);

      // AJAX 통신
      $.ajax({
      method: "POST",
      url: "http://localhost/learnAjax/serve.php",
      data: {"comment":jsonAjax}
      })
        .done(function(msg) {
          // 입력창 초기화
          $("#comment_name").val("");
          $("#comment_txt").val("");
          $(".tr").remove();

          // json => object
          var commentObj = JSON.parse(msg);

          // 출력
          var list='<tbody class="result">';
          for(key in commentObj){
            list +="<tr class=\"tr\">";
            list +="<td>"+key+"</td><td>"+commentObj[key]+"</td>";
            list +="</tr>";
          }
          list +="</tbody>";
          $("table").append(list);
        })
        .fail(function(){
          alert("Ajax fail");
        });
    });
  </script>
</body>

</html>
